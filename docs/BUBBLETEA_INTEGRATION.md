# Bubble Tea Integration Guide

**Using Tangent Characters with Bubble Tea Applications**

## Overview

Tangent is designed to **generate character frames**, not control the render loop. This makes it perfect for Bubble Tea apps where you need animated characters but want to maintain control over your event loop, styling, and layout.

---

## Integration Philosophy

### ✅ What Tangent Provides

- **Character Frame Data** - Multi-line Unicode block patterns
- **Library Characters** - Pre-built animations (alien, pulse, wave, rocket)
- **Export Tool** - Generate Go code for custom characters
- **Pattern System** - Easy character design

### ❌ What Tangent Doesn't Control

- **Render Loop** - Your Bubble Tea `tea.Msg` loop owns this
- **Terminal Output** - You control `stdout` via Bubble Tea
- **Styling/Colors** - Use Lip Gloss for colors and styles
- **Layout** - Your Bubble Tea views handle composition

---

## Integration Patterns

### Pattern A: Use Tangent as Frame Source for Bubbles Spinner

**Best for:** Quick integration with existing Bubble Tea apps

```go
package main

import (
    "github.com/charmbracelet/bubbles/spinner"
    tea "github.com/charmbracelet/bubbletea"
    "github.com/charmbracelet/lipgloss"
    "github.com/wildreason/tangent/pkg/characters"
)

type model struct {
    spinner spinner.Model
}

func initialModel() model {
    // Load Tangent character
    alien, _ := characters.Library("alien")
    
    // Convert Tangent frames to spinner frames
    frames := make([]string, len(alien.Frames))
    for i, frame := range alien.Frames {
        frames[i] = frame.Content
    }
    
    // Create Bubble Tea spinner with Tangent frames
    s := spinner.New()
    s.Spinner = spinner.Spinner{
        Frames: frames,
        FPS:    5,
    }
    
    return model{spinner: s}
}

func (m model) Init() tea.Cmd {
    return m.spinner.Tick
}

func (m model) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
    switch msg := msg.(type) {
    case tea.KeyMsg:
        if msg.String() == "q" {
            return m, tea.Quit
        }
    }
    
    var cmd tea.Cmd
    m.spinner, cmd = m.spinner.Update(msg)
    return m, cmd
}

func (m model) View() string {
    // Style with Lip Gloss
    style := lipgloss.NewStyle().
        Foreground(lipgloss.Color("#00FF00")).
        Bold(true)
    
    return style.Render(m.spinner.View())
}

func main() {
    p := tea.NewProgram(initialModel())
    p.Run()
}
```

---

### Pattern B: Export Custom Character and Commit to Repo

**Best for:** Custom characters specific to your app

#### Step 1: Design Character with Tangent

```bash
# Interactive mode
tangent

# Or CLI mode
tangent create --name loading --width 9 --height 5 \
  --frame spin1 '____F____,___5F6___,__5FFF6__,___5F6___,____F____' \
  --frame spin2 '____F____,___FFF___,__FFFFF__,___FFF___,____F____' \
  --output internal/characters/loading.go --package characters
```

#### Step 2: Use Generated Code

```go
// internal/characters/loading.go (generated by tangent)
package characters

import "github.com/wildreason/tangent/pkg/characters"

func GetLoading() (*characters.Character, error) {
    spec := characters.NewCharacterSpec("loading", 9, 5)
    spec = spec.AddFrame("spin1", []string{
        "____F____",
        "___5F6___",
        "__5FFF6__",
        "___5F6___",
        "____F____",
    })
    spec = spec.AddFrame("spin2", []string{
        "____F____",
        "___FFF___",
        "__FFFFF__",
        "___FFF___",
        "____F____",
    })
    return spec.Build()
}
```

#### Step 3: Integrate in Your App

```go
package main

import (
    "myapp/internal/characters"
    "github.com/charmbracelet/bubbles/spinner"
)

func setupSpinner() spinner.Model {
    loading, _ := characters.GetLoading()
    
    frames := make([]string, len(loading.Frames))
    for i, frame := range loading.Frames {
        frames[i] = frame.Content
    }
    
    s := spinner.New()
    s.Spinner = spinner.Spinner{Frames: frames, FPS: 8}
    return s
}
```

---

## Advanced Integration: Multi-Character Animations

For complex UIs with multiple animated characters:

```go
type model struct {
    agent    spinner.Model  // Using Tangent "wave" character
    loading  spinner.Model  // Using Tangent "pulse" character
    status   spinner.Model  // Using Tangent "rocket" character
}

func initialModel() model {
    // Agent character
    wave, _ := characters.Library("wave")
    agentFrames := extractFrames(wave)
    agent := createSpinner(agentFrames, 6)
    
    // Loading indicator
    pulse, _ := characters.Library("pulse")
    loadingFrames := extractFrames(pulse)
    loading := createSpinner(loadingFrames, 8)
    
    // Status indicator
    rocket, _ := characters.Library("rocket")
    statusFrames := extractFrames(rocket)
    status := createSpinner(statusFrames, 5)
    
    return model{
        agent:   agent,
        loading: loading,
        status:  status,
    }
}

func extractFrames(char *characters.Character) []string {
    frames := make([]string, len(char.Frames))
    for i, frame := range char.Frames {
        frames[i] = frame.Content
    }
    return frames
}

func createSpinner(frames []string, fps int) spinner.Model {
    s := spinner.New()
    s.Spinner = spinner.Spinner{Frames: frames, FPS: fps}
    return s
}

func (m model) View() string {
    return lipgloss.JoinVertical(
        lipgloss.Left,
        "Agent: "+m.agent.View(),
        "Loading: "+m.loading.View(),
        "Status: "+m.status.View(),
    )
}
```

---

## Styling with Lip Gloss

Tangent provides **shape/structure**, Lip Gloss provides **style/color**:

```go
import (
    "github.com/charmbracelet/lipgloss"
    "github.com/wildreason/tangent/pkg/characters"
)

func styledCharacter() string {
    alien, _ := characters.Library("alien")
    frame := alien.Frames[0].Content
    
    // Apply colors and styles
    style := lipgloss.NewStyle().
        Foreground(lipgloss.Color("#00FF00")).
        Background(lipgloss.Color("#000000")).
        Bold(true).
        Border(lipgloss.RoundedBorder()).
        BorderForeground(lipgloss.Color("#00FFFF")).
        Padding(1, 2)
    
    return style.Render(frame)
}
```

---

## Container Composition (Handwave Example)

For apps with tmux/overlay/window management:

```go
type HandwaveModel struct {
    activePane  string
    overlayMode bool
    character   spinner.Model  // Tangent character
}

func (m HandwaveModel) View() string {
    // Tangent character in overlay
    characterView := m.character.View()
    
    // Compose with tmux panes
    if m.overlayMode {
        return lipgloss.Place(
            width, height,
            lipgloss.Center, lipgloss.Center,
            characterView,
            lipgloss.WithWhitespaceChars("░"),
        )
    }
    
    // Normal layout
    return lipgloss.JoinHorizontal(
        lipgloss.Top,
        renderLeftPane(),
        characterView,
        renderRightPane(),
    )
}
```

---

## Don't Use: Tangent's Built-in Animate

**❌ Avoid in Bubble Tea apps:**

```go
// DON'T DO THIS
func (m model) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
    char, _ := characters.Library("alien")
    characters.Animate(os.Stdout, char, 5, 3)  // ❌ Takes over stdout!
    return m, nil
}
```

**Why?**
- `Animate()` writes directly to `os.Stdout`
- Conflicts with Bubble Tea's render loop
- Breaks terminal state management
- Incompatible with Lip Gloss layouts

**✅ Do this instead:**

```go
// Extract frames, let Bubble Tea handle rendering
frames := extractFrames(char)
m.spinner.Spinner.Frames = frames
```

---

## Example: Full Handwave Integration

```go
package main

import (
    tea "github.com/charmbracelet/bubbletea"
    "github.com/charmbracelet/lipgloss"
    "github.com/charmbracelet/bubbles/spinner"
    "github.com/wildreason/tangent/pkg/characters"
)

type handwaveModel struct {
    agent       spinner.Model
    overlay     bool
    tmuxActive  bool
}

func initialModel() handwaveModel {
    // Load Tangent character for agent
    wave, _ := characters.Library("wave")
    frames := make([]string, len(wave.Frames))
    for i, frame := range wave.Frames {
        frames[i] = frame.Content
    }
    
    s := spinner.New()
    s.Spinner = spinner.Spinner{Frames: frames, FPS: 6}
    
    return handwaveModel{agent: s}
}

func (m handwaveModel) Init() tea.Cmd {
    return m.agent.Tick
}

func (m handwaveModel) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
    switch msg := msg.(type) {
    case tea.KeyMsg:
        switch msg.String() {
        case "o":
            m.overlay = !m.overlay
        case "t":
            m.tmuxActive = !m.tmuxActive
        case "q":
            return m, tea.Quit
        }
    }
    
    var cmd tea.Cmd
    m.agent, cmd = m.agent.Update(msg)
    return m, cmd
}

func (m handwaveModel) View() string {
    agentStyle := lipgloss.NewStyle().
        Foreground(lipgloss.Color("#00FF00"))
    
    agentView := agentStyle.Render(m.agent.View())
    
    if m.overlay {
        // Overlay mode - center agent
        return lipgloss.Place(80, 24,
            lipgloss.Center, lipgloss.Center,
            agentView,
        )
    }
    
    if m.tmuxActive {
        // Tmux mode - split view
        return lipgloss.JoinHorizontal(
            lipgloss.Top,
            renderTmuxPane(),
            agentView,
        )
    }
    
    // Normal mode
    return agentView
}

func renderTmuxPane() string {
    return lipgloss.NewStyle().
        Border(lipgloss.NormalBorder()).
        Width(40).
        Render("Tmux Pane Content")
}

func main() {
    p := tea.NewProgram(initialModel())
    if err := p.Start(); err != nil {
        panic(err)
    }
}
```

---

## Summary

| Aspect | Tangent's Role | Your App's Role |
|--------|---------------|-----------------|
| **Character Frames** | ✅ Provides | Uses as data source |
| **Animation Timing** | ❌ Not involved | Bubble Tea `tea.Msg` loop |
| **Rendering** | ❌ Not involved | Bubble Tea views |
| **Styling/Colors** | ❌ Not involved | Lip Gloss |
| **Layout** | ❌ Not involved | Lip Gloss composition |
| **Terminal Control** | ❌ Not involved | Bubble Tea program |
| **Event Handling** | ❌ Not involved | Your `Update()` method |

**Tangent = Frame Generator**  
**Bubble Tea = Render Engine**  
**Lip Gloss = Style Engine**

---

## Links

- [Tangent Repository](https://github.com/wildreason/tangent)
- [Bubble Tea](https://github.com/charmbracelet/bubbletea)
- [Lip Gloss](https://github.com/charmbracelet/lipgloss)
- [Bubbles](https://github.com/charmbracelet/bubbles)

© 2025 Wildreason, Inc - MIT License

